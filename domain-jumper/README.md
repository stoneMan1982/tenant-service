# åŸŸåè·³è½¬ç³»ç»Ÿ (Domain Jumper)

ä¸€ä¸ªæ”¯æŒåŠ¨æ€å¤šçº§åŸŸåè·³è½¬çš„Webç³»ç»Ÿï¼Œå¯ä»¥æŒ‰ç…§é¢„è®¾çš„è·¯å¾„åœ¨å¤šä¸ªåŸŸåæ± ä¹‹é—´è¿›è¡Œè·³è½¬ï¼Œæœ€ç»ˆåˆ°è¾¾ç›®æ ‡åŸŸåã€‚

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

- **åŠ¨æ€åŸŸåæ± æ”¯æŒ**: æ”¯æŒä»»æ„æ•°é‡çš„ä¸­é—´åŸŸåæ± 
- **æ™ºèƒ½åŸŸåæ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹æ¯ä¸ªåŸŸåæ± ä¸­å¯ç”¨çš„åŸŸå
- **å®‰å…¨éšæœºè·³è½¬**: ä½¿ç”¨åŠ å¯†çº§éšæœºå­—ç¬¦ä¸²æ›¿æ¢å­åŸŸå
- **å®æ—¶è¿›åº¦æ˜¾ç¤º**: æ˜¾ç¤ºå½“å‰è·³è½¬è¿›åº¦å’ŒçŠ¶æ€
- **å®¹é”™æœºåˆ¶**: è‡ªåŠ¨å¤„ç†ä¸å¯ç”¨åŸŸåï¼Œé€‰æ‹©å¤‡ç”¨åŸŸå
- **åˆ†å¸ƒå¼éƒ¨ç½²**: æ”¯æŒå¤šæœåŠ¡å™¨éƒ¨ç½²

## ğŸ“‹ è·³è½¬æµç¨‹

ç³»ç»ŸæŒ‰ç…§ä»¥ä¸‹æµç¨‹è¿›è¡Œè·³è½¬ï¼š

```
startDomain â†’ pool1 â†’ pool2 â†’ ... â†’ poolN â†’ target_pool â†’ æœ€ç»ˆç›®æ ‡
```

- **ä¸­é—´æ± ** (`type: "intermediate"`): å¯ä»¥æœ‰ä»»æ„å¤šä¸ªï¼Œä¾æ¬¡è·³è½¬
- **ç›®æ ‡æ± ** (`type: "target"`): åªæœ‰ä¸€ä¸ªï¼Œæ˜¯è·³è½¬çš„ç»ˆç‚¹

## ğŸ“ é¡¹ç›®ç»“æ„

```
distributed_test/
â”œâ”€â”€ server1/                 # æœåŠ¡å™¨1
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ domains.json     # åŸŸåæ± é…ç½®
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ index.html       # ä¸»é¡µé¢
â”‚       â””â”€â”€ jumper.js        # è·³è½¬é€»è¾‘
â”œâ”€â”€ server2/                 # æœåŠ¡å™¨2 (ç›¸åŒç»“æ„)
â”œâ”€â”€ server3/                 # æœåŠ¡å™¨3 (ç›¸åŒç»“æ„)
â””â”€â”€ README.md               # æœ¬æ–‡æ¡£
```

## âš™ï¸ é…ç½®æ–‡ä»¶

### domains.json é…ç½®ç¤ºä¾‹

```json
{
  "startDomain": "http://test1.localhost:8001",
  "domainPools": [
    {
      "name": "pool1",
      "type": "intermediate",
      "domains": [
        "http://pool1-1.test1.localhost:8001",
        "http://pool1-2.test1.localhost:8001",
        "http://pool1-3.test1.localhost:8001"
      ]
    },
    {
      "name": "pool2", 
      "type": "intermediate",
      "domains": [
        "http://pool2-1.test2.localhost:8002",
        "http://pool2-2.test2.localhost:8002"
      ]
    },
    {
      "name": "target_pool",
      "type": "target",
      "domains": [
        "http://target1.final.localhost:8003",
        "http://target2.final.localhost:8003"
      ]
    }
  ],
  "timeoutMs": 3000,
  "jumpDelayMs": 1000
}
```

### é…ç½®å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `startDomain` | string | èµ·å§‹åŸŸå |
| `domainPools` | array | åŸŸåæ± æ•°ç»„ |
| `name` | string | æ± å­åç§° |
| `type` | string | æ± å­ç±»å‹ï¼š`intermediate`(ä¸­é—´æ± ) æˆ– `target`(ç›®æ ‡æ± ) |
| `domains` | array | è¯¥æ± å­ä¸­çš„åŸŸååˆ—è¡¨ |
| `timeoutMs` | number | åŸŸåæ£€æµ‹è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| `jumpDelayMs` | number | è·³è½¬å»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |

## ğŸ”§ éƒ¨ç½²è¯´æ˜

### 1. åŸºæœ¬éƒ¨ç½²

æ¯ä¸ªserverç›®å½•éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œå¯ä»¥éƒ¨ç½²åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼š

```bash
# è¿›å…¥ä»»ä¸€serverç›®å½•
cd server1

# å¯åŠ¨ç®€å•HTTPæœåŠ¡å™¨ (Python)
python3 -m http.server 8001

# æˆ–è€…ä½¿ç”¨Node.js
npx http-server -p 8001
```

### 2. é…ç½®åŸŸåæ± 

æ ¹æ®æ‚¨çš„éœ€æ±‚ä¿®æ”¹ `config/domains.json`ï¼š

1. **æ·»åŠ ä¸­é—´æ± **: åœ¨ `domainPools` æ•°ç»„ä¸­æ·»åŠ æ›´å¤š `type: "intermediate"` çš„æ± å­
2. **è®¾ç½®ç›®æ ‡æ± **: ç¡®ä¿æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª `type: "target"` çš„æ± å­
3. **é…ç½®åŸŸå**: åœ¨æ¯ä¸ªæ± å­çš„ `domains` æ•°ç»„ä¸­æ·»åŠ å®é™…å¯ç”¨çš„åŸŸå

### 3. å¤šæœåŠ¡å™¨åŒæ­¥

æ‰€æœ‰serverç›®å½•çš„é…ç½®å’Œä»£ç åº”è¯¥ä¿æŒåŒæ­¥ï¼š

```bash
# åŒæ­¥é…ç½®æ–‡ä»¶
cp server1/config/domains.json server2/config/domains.json
cp server1/config/domains.json server3/config/domains.json

# åŒæ­¥ä»£ç æ–‡ä»¶
cp server1/static/jumper.js server2/static/jumper.js  
cp server1/static/jumper.js server3/static/jumper.js
```

## ğŸš¦ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨ç³»ç»Ÿ

1. éƒ¨ç½²å¹¶å¯åŠ¨å„ä¸ªæœåŠ¡å™¨
2. ç¡®ä¿æ‰€æœ‰åŸŸåéƒ½èƒ½æ­£å¸¸è®¿é—®
3. è®¿é—®èµ·å§‹åŸŸåå¼€å§‹è·³è½¬æµç¨‹

### 2. è·³è½¬è¿‡ç¨‹

1. **åˆå§‹åŒ–**: ç³»ç»ŸåŠ è½½é…ç½®ï¼Œè®¡ç®—æ€»æ­¥éª¤æ•°
2. **åŸŸåæ£€æµ‹**: å¹¶å‘æ£€æµ‹å½“å‰æ± å­ä¸­æ‰€æœ‰åŸŸåçš„å¯ç”¨æ€§
3. **é€‰æ‹©åŸŸå**: é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨çš„åŸŸå
4. **éšæœºè·³è½¬**: ä½¿ç”¨éšæœºå­—ç¬¦ä¸²æ›¿æ¢å­åŸŸååè·³è½¬
5. **é‡å¤æµç¨‹**: åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šé‡å¤ä¸Šè¿°è¿‡ç¨‹
6. **åˆ°è¾¾ç›®æ ‡**: åˆ°è¾¾ç›®æ ‡æ± åè¿›è¡Œæœ€ç»ˆè·³è½¬

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### éšæœºå­—ç¬¦ä¸²ç”Ÿæˆ

ç³»ç»Ÿä½¿ç”¨ `window.crypto.getRandomValues()` ç”ŸæˆåŠ å¯†çº§éšæœºå­—ç¬¦ä¸²ï¼š

```javascript
function generateRandomString() {
    const length = Math.floor(Math.random() * 4) + 3; // 3-6ä½éšæœºé•¿åº¦
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    const randomValues = new Uint32Array(length);
    window.crypto.getRandomValues(randomValues);
    
    let result = '';
    for (let i = 0; i < length; i++) {
        result += chars[randomValues[i] % chars.length];
    }
    return result;
}
```

### å­åŸŸåæ›¿æ¢

è·³è½¬æ—¶ä¼šè‡ªåŠ¨æ›¿æ¢å­åŸŸåï¼š
```
åŸåŸŸå: http://pool1-1.test1.localhost:8001
è·³è½¬å: http://Kx9aB.test1.localhost:8001
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **åŸŸåä¸å¯ç”¨**
   - ç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•æ± å­ä¸­çš„å…¶ä»–åŸŸå
   - å¦‚æœæ•´ä¸ªæ± å­éƒ½ä¸å¯ç”¨ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

2. **è·³è½¬å¡ä½**
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - ç¡®è®¤ç›®æ ‡åŸŸåæ˜¯å¦æ­£ç¡®é…ç½®
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

3. **é…ç½®é”™è¯¯**
   - ç¡®ä¿JSONæ ¼å¼æ­£ç¡®
   - æ£€æŸ¥åŸŸåæ ¼å¼æ˜¯å¦æœ‰æ•ˆ
   - ç¡®ä¿æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª `type: "target"` çš„æ± å­

### è°ƒè¯•æ¨¡å¼

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œåœ¨Consoleä¸­å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„è·³è½¬æ—¥å¿—ã€‚

## ğŸ“ å¼€å‘è¯´æ˜

### ä»£ç ç»“æ„

- **DomainJumperç±»**: å¤„ç†åˆå§‹è·³è½¬é€»è¾‘
- **IntermediateJumperç±»**: å¤„ç†ä¸­é—´è·³è½¬é€»è¾‘
- **åŸŸåæ£€æµ‹**: ä½¿ç”¨fetchæ£€æµ‹åŸŸåå¯ç”¨æ€§
- **è¿›åº¦ç®¡ç†**: åŠ¨æ€è®¡ç®—å’Œæ˜¾ç¤ºè·³è½¬è¿›åº¦

### æ‰©å±•åŠŸèƒ½

å¦‚éœ€æ·»åŠ æ–°åŠŸèƒ½ï¼Œä¸»è¦ä¿®æ”¹ `jumper.js` æ–‡ä»¶ï¼š

1. **ä¿®æ”¹æ£€æµ‹é€»è¾‘**: ä¿®æ”¹ `checkDomainAvailability` æ–¹æ³•
2. **è‡ªå®šä¹‰è·³è½¬è§„åˆ™**: ä¿®æ”¹ `startJumpSequence` æ–¹æ³•  
3. **UIå¢å¼º**: ä¿®æ”¹ç›¸å…³çš„çŠ¶æ€æ›´æ–°æ–¹æ³•

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

---

**æ³¨æ„**: è¯·ç¡®ä¿åœ¨åˆæ³•å’Œæˆæƒçš„ç¯å¢ƒä¸­ä½¿ç”¨æ­¤ç³»ç»Ÿã€‚